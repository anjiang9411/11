# 🧠 AI记忆互通设置功能

## 功能说明

用户现在可以自定义AI角色的记忆互通条数，完全控制AI能记住多少历史对话。

## 设置位置

在微信主界面顶部的**设置按钮（⚙️）** → **AI主动发消息配置** → 滚动到底部查看**记忆互通设置**

## 配置选项

### 1. 总记忆条数
- **说明**：AI角色能记住的所有对话记录总数（包括私聊和群聊）
- **默认值**：50条
- **范围**：10-200条
- **用途**：控制AI的记忆容量，数值越大，AI记得越多

### 2. 跨场景预览条数
- **说明**：在当前对话中显示其他场景的最近记忆数量
- **默认值**：5条
- **范围**：3-20条
- **用途**：控制AI在当前对话中能看到多少其他场景的记忆

## 使用场景

### 场景1：轻量级记忆（推荐日常使用）
- **总记忆条数**：30条
- **跨场景预览**：3条
- **优点**：响应快，适合短期对话
- **适用于**：日常闲聊、简单互动

### 场景2：标准记忆（默认配置）
- **总记忆条数**：50条
- **跨场景预览**：5条
- **优点**：平衡性能和记忆能力
- **适用于**：大多数使用场景

### 场景3：深度记忆（长期互动）
- **总记忆条数**：100-150条
- **跨场景预览**：8-10条
- **优点**：AI能记住很多历史，互动更连贯
- **适用于**：长期角色扮演、复杂剧情

### 场景4：完整记忆（专业用途）
- **总记忆条数**：200条
- **跨场景预览**：15-20条
- **优点**：最大化记忆能力，AI几乎不会忘记
- **适用于**：需要极高连贯性的场景

## 工作原理

```
用户在私聊中说："明天我生日"
  ↓
AI记住这条消息（存入总记忆）
  ↓
在群聊中，AI看到跨场景预览：
  "[1月5日 14:30][私聊] 对方: 明天我生日"
  ↓
AI在群聊中自然提及：
  "@用户 明天你生日对吧！大家一起庆祝~"
```

## 实时生效

- ✅ 修改后**立即保存**并生效
- ✅ 不需要重启应用
- ✅ 自动应用到所有AI角色

## 性能建议

### 移动设备
- 建议：总记忆50条，预览5条
- 原因：保证流畅度

### 桌面端
- 建议：总记忆100-150条，预览10条
- 原因：性能充足，可以更多记忆

### API调用考虑
- 记忆条数越多，发送给API的上下文越长
- 可能影响响应速度和API费用
- 根据使用的AI模型调整：
  - GPT-4: 建议100条以内
  - Claude: 可以150-200条
  - 本地模型: 根据性能调整

## 技术实现

### 文件修改
1. `/components/WeChat.tsx`
   - 添加 `memoryCount` 和 `memoryPreviewCount` 到配置接口
   - 在设置界面添加输入控件

2. `/utils/aiMemory.tsx`
   - 更新函数接受自定义记忆条数参数

3. `/utils/groupChatAi.tsx`
   - 传递用户配置的记忆条数

### 数据流
```
用户设置
  ↓
aiAutoMessageConfig.memoryCount
  ↓
传递给 getRelevantMemorySummary()
  ↓
AI看到相应数量的历史记忆
```

## 常见问题

**Q: 修改记忆条数会删除历史消息吗？**
A: 不会！只是控制AI能"看到"多少历史，实际消息都保存着。

**Q: 设置太大会有什么影响？**
A: 可能导致AI响应变慢，API调用费用增加。

**Q: 设置太小会怎样？**
A: AI会"健忘"，可能忘记之前的对话内容。

**Q: 每个AI角色可以单独设置吗？**
A: 目前是全局设置，应用到所有AI角色。

**Q: 如何知道当前设置是否合适？**
A: 测试AI的回复：
- 如果AI经常忘记之前说的话 → 增加记忆条数
- 如果AI响应很慢 → 减少记忆条数

## 最佳实践

1. **先用默认值（50/5）测试**
2. **根据实际体验调整**
3. **不要一次性设太大**，逐步增加
4. **观察AI回复质量**和响应速度
5. **考虑API费用**，合理设置

## 更新日志

- ✅ 2025-01-13: 添加自定义记忆条数功能
- ✅ 支持10-200条总记忆
- ✅ 支持3-20条跨场景预览
- ✅ 实时保存和生效
